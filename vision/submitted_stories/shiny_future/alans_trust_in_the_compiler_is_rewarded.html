<!DOCTYPE HTML>
<html lang="en" class="light sidebar-visible" dir="ltr">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>Alan&#x27;s trust in the compiler is rewarded - wg-async</title>


        <!-- Custom HTML head -->

        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff">

        <link rel="icon" href="../../../favicon.svg">
        <link rel="shortcut icon" href="../../../favicon.png">
        <link rel="stylesheet" href="../../../css/variables.css">
        <link rel="stylesheet" href="../../../css/general.css">
        <link rel="stylesheet" href="../../../css/chrome.css">
        <link rel="stylesheet" href="../../../css/print.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="../../../FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="../../../fonts/fonts.css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="../../../highlight.css">
        <link rel="stylesheet" href="../../../tomorrow-night.css">
        <link rel="stylesheet" href="../../../ayu-highlight.css">

        <!-- Custom theme stylesheets -->


        <!-- Provide site root to javascript -->
        <script>
            var path_to_root = "../../../";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "light";
        </script>
        <!-- Start loading toc.js asap -->
        <script src="../../../toc.js"></script>
    </head>
    <body>
    <div id="body-container">
        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script>
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script>
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            const html = document.documentElement;
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add("js");
        </script>

        <input type="checkbox" id="sidebar-toggle-anchor" class="hidden">

        <!-- Hide / unhide sidebar before it is displayed -->
        <script>
            var sidebar = null;
            var sidebar_toggle = document.getElementById("sidebar-toggle-anchor");
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            } else {
                sidebar = 'hidden';
            }
            sidebar_toggle.checked = sidebar === 'visible';
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <!-- populated by js -->
            <mdbook-sidebar-scrollbox class="sidebar-scrollbox"></mdbook-sidebar-scrollbox>
            <noscript>
                <iframe class="sidebar-iframe-outer" src="../../../toc.html"></iframe>
            </noscript>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle">
                <div class="sidebar-resize-indicator"></div>
            </div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky">
                    <div class="left-buttons">
                        <label id="sidebar-toggle" class="icon-button" for="sidebar-toggle-anchor" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </label>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title">wg-async</h1>

                    <div class="right-buttons">
                        <a href="../../../print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>
                        <a href="https://github.com/rust-lang/wg-async" title="Git repository" aria-label="Git repository">
                            <i id="git-repository-button" class="fa fa-github"></i>
                        </a>
                        <a href="https://github.com/rust-lang/wg-async/edit/master/src/vision/submitted_stories/shiny_future/alans_trust_in_the_compiler_is_rewarded.md" title="Suggest an edit" aria-label="Suggest an edit">
                            <i id="git-edit-button" class="fa fa-edit"></i>
                        </a>

                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script>
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1 id="-shiny-future-stories-alans-trust-in-the-compiler-is-rewarded"><a class="header" href="#-shiny-future-stories-alans-trust-in-the-compiler-is-rewarded">âœ¨ Shiny future stories: Alan's trust in the compiler is rewarded</a></h1>
<h2 id="-warning-draft-status-"><a class="header" href="#-warning-draft-status-">ðŸš§ Warning: Draft status ðŸš§</a></h2>
<p>This is a draft "shiny future" story submitted as part of the brainstorming period. It is derived from what actual Rust users wish async Rust should be, and is meant to deal with some of the challenges that Async Rust programmers face today.</p>
<p>If you would like to expand on this story, or adjust the answers to the FAQ, feel free to open a PR making edits (but keep in mind that, as peoples needs and desires for async Rust may differ greatly, shiny future stories <a href="../../how_to_vision/comment.html#comment-to-understand-or-improve-not-to-negate-or-dissuade">cannot be wrong</a>. At worst they are only useful for a small set of people or their problems might be better solved with alternative solutions). Alternatively, you may wish to <a href="../shiny_future.html">add your own shiny vision story</a>!</p>
<h2 id="the-story"><a class="header" href="#the-story">The story</a></h2>
<h3 id="trust-the-compiler"><a class="header" href="#trust-the-compiler">Trust the compiler</a></h3>
<p>Alan has a lot of experience in C#, but in the meantime has created some successful projects in Rust.
He has dealt with his fair share of race conditions/thread safety issues during runtime in C#, but is now starting to trust that if his Rust code compiles,
he won't have those annoying runtime problems to deal with.</p>
<p>This allows him to try to squeeze his programs for as much performance as he wants, because the compiler will stop him when he tries things that could result in runtime problems.
After seeing the performance and the lack of runtime problems, he starts to trust the compiler more and more with each project finished.</p>
<p>He knows what he can do with external libraries, he does not need to fear concurrency issues if the library cannot be used from multiple threads, because the compiler would tell him.</p>
<p>His trust in the compiler solidifies further the more he codes in Rust.</p>
<h3 id="the-first-async-project"><a class="header" href="#the-first-async-project">The first async project</a></h3>
<p>Alan now starts with his first async project. He opens up the Rust book to the "Async I/O" chapter and it guides him to writing his first program. He starts by writing some synchronous code to write to the file system:</p>
<pre><pre class="playground"><code class="language-rust edition2018">use std::fs::File;

fn main() -&gt; Result&lt;(), Box&lt;dyn std::error::Error&gt;&gt; {
    let mut file = File::create("a.txt")?;
    file.write_all(b"Hello, world!")?;
    Ok(())
}</code></pre></pre>
<p>Next, he adapts that to run in an async fashion. He starts by converting <code>main</code> into <code>async fn main</code>:</p>
<pre><pre class="playground"><code class="language-rust edition2018">use std::fs::File;

async fn main() -&gt; Result&lt;(), Box&lt;dyn std::error::Error&gt;&gt; {
    let mut file = File::create("a.txt")?;
    file.write_all(b"Hello, world!")?;
    Ok(())
}</code></pre></pre>
<p>The code compiles, but he gets a warning:</p>
<pre><code>warning: using a blocking API within an async function
 --&gt; src/main.rs:4:25
1 | use std::fs::File;
  |     ------------- try changing to `std::async_io::fs::File`
  | ...
4 |     let mut file: u32 = File::create("a.txt")?;
  |                         ^^^^^^^^^^^^ blocking functions should not be used in async fn
help: try importing the async version of this type
 --&gt; src/main.rs:1
1 | use std::async_fs::File;
</code></pre>
<p>"Oh, right," he says, "I am supposed to use the async variants of the APIs." He applies the suggested fix in his IDE, and now his code looks like:</p>
<pre><pre class="playground"><code class="language-rust edition2018">use std::async_fs::File;

async fn main() -&gt; Result&lt;(), Box&lt;dyn std::error::Error&gt;&gt; {
    let mut file = File::create("a.txt")?;
    file.write_all(b"Hello, world!")?;
    Ok(())
}</code></pre></pre>
<p>His IDE recompiles instantaneously and he now sees two little squiggles, one under each <code>?</code>. Clicking on the errors, he sees:</p>
<pre><code>error: missing await
 --&gt; src/main.rs:4:25
4 |     let mut file: u32 = File::create("a.txt")?;
  |                                              ^ returns a future, which requires an await
help: try adding an await
 --&gt; src/main.rs:1
4 |     let mut file: u32 = File::create("a.txt").await?;
</code></pre>
<p>He again applies the suggested fix, and his code now shows:</p>
<pre><pre class="playground"><code class="language-rust edition2018">use std::async_fs::File;

async fn main() -&gt; Result&lt;(), Box&lt;dyn std::error::Error&gt;&gt; {
    let mut file = File::create("a.txt").await?;
    file.write_all(b"Hello, world!").await?;
    Ok(())
}</code></pre></pre>
<p>Happily, it compiles, and when he runs it, everything works as expected. "Cool," he thinks, "this async stuff is pretty easy!"</p>
<h3 id="making-some-web-requests"><a class="header" href="#making-some-web-requests">Making some web requests</a></h3>
<p>Next, Alan decides to experiment with some simple web requests. This isn't part of the standard library, but the <code>fetch_rs</code> package is listed in the Rust book. He runs <code>cargo add fetch_rs</code> to add it to his <code>Cargo.toml</code> and then writes:</p>
<pre><pre class="playground"><code class="language-rust edition2018">use std::async_fs::File;
use fetch_rs;

async fn main() -&gt; Result&lt;(), Box&lt;dyn std::error::Error&gt;&gt; {
    let mut file = File::create("a.txt")?;
    file.write_all(b"Hello, world!")?;

    let body = fetch_rs::get("https://www.rust-lang.org")
        .await?
        .text()
        .await?;
    println!("{}", body);

    Ok(())
}</code></pre></pre>
<p>This feels pretty easy!</p>
<h2 id="-frequently-asked-questions"><a class="header" href="#-frequently-asked-questions">ðŸ¤” Frequently Asked Questions</a></h2>
<h3 id="what-status-quo-story-or-stories-are-you-retelling"><a class="header" href="#what-status-quo-story-or-stories-are-you-retelling">What status quo story or stories are you retelling?</a></h3>
<ul>
<li><a href="../status_quo/alan_started_trusting_the_rust_compiler_but_then_async.html">Alan started trusting the Rust compiler, but then async</a></li>
<li><a href="../status_quo/barbara_makes_their_first_steps_into_async.html">Barbara makes their first foray into async</a></li>
</ul>
<h3 id="what-are-the-key-points-you-were-trying-to-convey-with-this-status-quo-story"><a class="header" href="#what-are-the-key-points-you-were-trying-to-convey-with-this-status-quo-story">What are the key points you were trying to convey with this status quo story?</a></h3>
<ul>
<li>Getting started with async should be as automated as possible:
<ul>
<li>change <code>main</code> to an <code>async fn</code>;</li>
<li>use the APIs found in modules like <code>std::async_foo</code>, which should map as closely as possible to their non-async equivalents.</li>
</ul>
</li>
<li>You should get some sort of default runtime that is decent</li>
<li>Lints should guide you in using async:
<ul>
<li>identifying blocking functions</li>
<li>identifying missing <code>await</code></li>
</ul>
</li>
<li>You should be able to grab libraries from the ecosystem and they should integrate with the default runtime without fuss</li>
</ul>
<h3 id="is-there-a-one-size-fits-all-runtime-in-this-future"><a class="header" href="#is-there-a-one-size-fits-all-runtime-in-this-future">Is there a "one size fits all" runtime in this future?</a></h3>
<p>This particular story doesn't talk about what happens when the default runtime isn't suitable. But you may want to read its sequel, <a href="./alan_switches_runtimes.html">"Alan Switches Runtimes"</a>.</p>
<h3 id="what-is-alan-most-excited-about-in-this-future-is-he-disappointed-by-anything"><a class="header" href="#what-is-alan-most-excited-about-in-this-future-is-he-disappointed-by-anything"><strong>What is <a href="../../characters/alan.html">Alan</a> most excited about in this future? Is he disappointed by anything?</strong></a></h3>
<p>Alan is excited about how easy it is to get async programs up and running. He also finds the performance is good. He's good.</p>
<h3 id="what-is-grace-most-excited-about-in-this-future-is-she-disappointed-by-anything"><a class="header" href="#what-is-grace-most-excited-about-in-this-future-is-she-disappointed-by-anything"><strong>What is <a href="../../characters/grace.html">Grace</a> most excited about in this future? Is she disappointed by anything?</strong></a></h3>
<p>Grace is happy because she is getting strong safety guarantees and isn't getting surprising runtime panics when composing libraries. The question of whether she's able to use the tricks she knows and loves is a good one, though. The default scheduler may not optimize for maximum performance -- this is something to explore in future stories. The <a href="./alan_switches_runtimes.html">"Alan Switches Runtimes"</a>, for example, talks more about the ability to change runtimes.</p>
<h3 id="what-is-niklaus-most-excited-about-in-this-future-is-he-disappointed-by-anything"><a class="header" href="#what-is-niklaus-most-excited-about-in-this-future-is-he-disappointed-by-anything"><strong>What is <a href="../../characters/niklaus.html">Niklaus</a> most excited about in this future? Is he disappointed by anything?</strong></a></h3>
<p>Niklaus is quite happy. Async Rust is fairly familiar and usable for him. Further, the standard library includes "just enough" infrastructure to enable a vibrant crates-io ecosystem without centralizing everything.</p>
<h3 id="what-is-barbara-most-excited-about-in-this-future-is-she-disappointed-by-anything"><a class="header" href="#what-is-barbara-most-excited-about-in-this-future-is-she-disappointed-by-anything"><strong>What is <a href="../../characters/barbara.html">Barbara</a> most excited about in this future? Is she disappointed by anything?</strong></a></h3>
<p>Barbara quite likes that the std APIs for sync and sync fit together, and that there is a consistent naming scheme across them. She likes that there is a flourishing ecosystem of async crates that she can choose from.</p>
<h3 id="what-projects-benefit-the-most-from-this-future"><a class="header" href="#what-projects-benefit-the-most-from-this-future"><strong>What <a href="../../projects.html">projects</a> benefit the most from this future?</strong></a></h3>
<p>A number of projects benefit:</p>
<ul>
<li>Projects like <a href="../../projects/YouBuy.html">YouBuy</a> are able to get up and going faster.</li>
<li>Libraries like <a href="../../projects/SLOW.html">SLOW</a> become easier because they can target the std APIs and there is a defined plan for porting across runtimes.</li>
</ul>
<h3 id="are-there-any-projects-that-are-hindered-by-this-future"><a class="header" href="#are-there-any-projects-that-are-hindered-by-this-future"><strong>Are there any <a href="../../projects.html">projects</a> that are hindered by this future?</strong></a></h3>
<p>It depends on the details of how we integrate other runtimes. If we wound up with a future where most libraries are "hard-coded" to a single default runtime, this could very well hinder any number of projects, but nobody wants that.</p>
<h3 id="what-are-the-incremental-steps-towards-realizing-this-shiny-future"><a class="header" href="#what-are-the-incremental-steps-towards-realizing-this-shiny-future"><strong>What are the incremental steps towards realizing this shiny future?</strong></a></h3>
<p>This question can't really be answered in isolation, because so much depends on the story for how we integrate with other runtimes. I don't think we can accept a future where is literally a single runtime that everyone has to use, but I wanted to pull out the question of "non-default runtimes" (as well as more details about the default) to other stories.</p>
<h3 id="does-realizing-this-future-require-cooperation-between-many-projects"><a class="header" href="#does-realizing-this-future-require-cooperation-between-many-projects"><strong>Does realizing this future require cooperation between many projects?</strong></a></h3>
<p>Yes. For external libraries like <code>fetch_rs</code> to interoperate they will want to use the std APIs (and probably traits).</p>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                            <a rel="prev" href="../../../vision/submitted_stories/shiny_future/alan_learns_async_on_his_own.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>

                            <a rel="next prefetch" href="../../../vision/submitted_stories/shiny_future/alan_switches_runtimes.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                    <a rel="prev" href="../../../vision/submitted_stories/shiny_future/alan_learns_async_on_his_own.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>

                    <a rel="next prefetch" href="../../../vision/submitted_stories/shiny_future/alan_switches_runtimes.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
            </nav>

        </div>




        <script>
            window.playground_copyable = true;
        </script>


        <script src="../../../elasticlunr.min.js"></script>
        <script src="../../../mark.min.js"></script>
        <script src="../../../searcher.js"></script>

        <script src="../../../clipboard.min.js"></script>
        <script src="../../../highlight.js"></script>
        <script src="../../../book.js"></script>

        <!-- Custom JS scripts -->
        <script src="../../../mermaid.min.js"></script>
        <script src="../../../mermaid-init.js"></script>


    </div>
    </body>
</html>
